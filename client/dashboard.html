<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - SafaTech Solution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #181122 0%, #3d265f 100%);
      color: #f6f3ff;
      overflow-x: hidden;
    }
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 90px;
      background: linear-gradient(180deg, #22103a 0%, #19082c 100%);
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 24px 0 20px 0;
      box-shadow: 0 0 24px #0009;
      border-radius: 2.2rem;
      margin: 14px 0 14px 14px;
      transition: width .33s cubic-bezier(.7,.32,.23,1.1);
    }
    .nav-bar .nav-logo {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .nav-bar .nav-logo img {
      width: 42px;
      height: 42px;
      margin-bottom: 7px;
      border-radius: 1.1rem;
      background: #5d1e9ca8;
      box-shadow: 0 2px 7px #b09ac9;
    }
    .nav-bar .nav-logo span {
      color: #eae1e1;
      font-size: 1rem;
      font-weight: 750;
      letter-spacing: 1.1px;
      margin-bottom: 1px;
      margin-top: 2px;
      text-shadow: 0 2px 6px #a259f7;
    }
    .nav-bar .nav-logo .tools {
      font-size: 0.92rem;
      font-weight: 600;
      color: #b8a3d0;
      letter-spacing: 1px;
      margin-top: -2px;
      opacity: 0.89;
    }
    .nav-bar .nav-links {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      margin-top: 18px;
    }
    .nav-bar .nav-link {
      width: 54px;
      height: 54px;
      margin: 0 auto;
      border-radius: 1.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      color: #a59edb;
      font-size: 1.7rem;
      margin-bottom: 2px;
      transition: background 0.18s, color 0.18s;
      box-shadow: 0 2px 6px #0002;
      cursor: pointer;
      position: relative;
    }
    .nav-bar .nav-link.active, .nav-bar .nav-link:hover {
      background: linear-gradient(90deg,#a259f7 0%,#7e36c9 100%);
      color: #fff;
      box-shadow: 0 2px 9px #a259f74e;
    }
    .nav-bar .nav-link svg {
      width: 30px;
      height: 30px;
      display: block;
    }
    .nav-bar .profile-section {
      width: 78px;
      background: #0f0f0f;
      border-radius: 1.5rem;
      box-shadow: 0 5px 9px #b09ac9;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px 0 15px 0;
      margin-bottom: 5px;
      gap: 16px;
    }
    .nav-bar .profile-section .profile-avatar-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      cursor: pointer;
      text-decoration: none;
    }
    .nav-bar .profile-section .profile-avatar {
      background: #a259f7;
      color: #fff;
      font-size: 1.14rem;
      width: 2.3rem;
      height: 2.3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      margin-bottom: 0;
      transition: box-shadow 0.16s;
    }
    .nav-bar .profile-section .profile-avatar:hover {
      box-shadow: 0 0 0 4px #a259f76e;
    }
    /* Hide name and email in sidebar */
    .nav-bar .profile-section .profile-name,
    .nav-bar .profile-section .profile-meta {
      display: none !important;
    }
    .nav-bar .logout-btn {
      background: linear-gradient(90deg, #a259f7 0%, #6c67f7 100%);
      color: #fff;
      border: none;
      padding: 0.7rem 0;
      font-weight: 800;
      border-radius: 0.8rem;
      width: 90%;
      box-shadow: 0 2px 9px #a259f72c;
      font-size: 0.9rem;
      transition: background .17s, color .14s;
      display: block;
      cursor: pointer;
      text-align: center;
      margin: 0;
      letter-spacing: 0.5px;
    }
    .nav-bar .logout-btn:hover {
      background: linear-gradient(90deg, #6c67f7 0%, #a259f7 100%);
      color: #fff;
    }
    @media (max-width: 1300px) {
      .main-content { margin-left: 0; }
      .nav-bar { display: none; }
    }
    @media (max-width: 900px) {
      .dashboard-row { flex-direction: column; gap: 1.2rem; }
      .main-content { margin-left: 0; }
      .nav-bar { display: none; }
      .dashboard-header-row { flex-direction: column; gap: 1.2rem; align-items: flex-start;}
      .tool-list-card { margin-bottom: 1.2rem;}
    }
    .main-content {
      margin-left: 110px;
      min-height: 100vh;
      padding: 0 1vw 2vw 1vw;
      background: none;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
    }
   .dashboard-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 36px;
      margin-bottom: 35px;
      padding-bottom: 0;
      border-radius: 1.4rem;
    }
    .dashboard-title {
      font-size: 2.2rem;
      font-weight: 900;
      color: #fff;
      letter-spacing: 1.3px;
      text-shadow: 0 3px 18px #a259f732;
      margin-bottom: 0.1rem;
    }
    .dashboard-greeting {
      font-size: 1.13rem;
      color: #a259f7;
      letter-spacing: 1px;
      font-weight: 700;
      opacity: 0.95;
    }
    .user-profile-bar {
      display: flex;
      align-items: center;
      gap: 1.2rem;
    }
    .user-profile-bar .profile-avatar {
      width: 2.5rem; height: 2.5rem;
      background: #a259f7;
      color: #fff;
      font-size: 1.35rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      margin-right: 0.7rem;
    }
    .user-profile-bar .name {
      font-weight: 800;
      font-size: 1.12rem;
      color: #fff;
      letter-spacing: 1px;
    }
    .user-profile-bar .email {
      color: #bba9fa;
      font-size: 0.95rem;
      font-weight: 500;
      opacity: 0.82;
    }
    .dashboard-row {
      display: flex;
      gap: 2.2rem;
      margin-bottom: 2rem;
    }
    .dashboard-card {
      background: linear-gradient(135deg,#231142 70%,#a259f7 100%);
      border-radius: 1.7rem;
      box-shadow: 0 6px 36px #a259f722, 0 2px 12px #0007;
      padding: 2.1rem 2rem 1.4rem 2.1rem;
      color: #fff;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      min-width: 0;
      position: relative;
      overflow: hidden;
    }
    .dashboard-card-title {
      font-size: 1.11rem;
      font-weight: 700;
      color: #fff;
      opacity: 0.93;
      letter-spacing: 0.5px;
      margin-bottom: 0.4rem;
    }
    .dashboard-card-value {
      font-size: 2.3rem;
      font-weight: 900;
      color: #a259f7;
      text-shadow: 0 2px 8px #a259f7bb;
    }
    .dashboard-card-small {
      font-size: 0.97rem;
      color: #bba9fa;
      font-weight: 600;
      margin-bottom: 0.6rem;
    }
    .tool-list-card {
      background: linear-gradient(135deg,#231142 70%,#282442 100%);
      border-radius: 1.3rem;
      box-shadow: 0 6px 24px #a259f71c, 0 2px 8px #0007;
      padding: 1.4rem 1.3rem 1.25rem 1.3rem;
      color: #fff;
      min-width: 0;
      margin-bottom: 2rem;
    }
    .tool-list-title {
      font-size: 1.17rem;
      font-weight: 700;
      color: #a259f7;
      margin-bottom: 1.1rem;
    }
    .tool-list-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0.1rem;
    }
    .tool-list-table th,
    .tool-list-table td {
      padding: 0.7rem 1rem;
      text-align: left;
    }
    .tool-list-table th {
      color: #a259f7;
      font-size: 1.04rem;
      font-weight: 700;
      background: #20113a;
    }
    .tool-list-table tr {
      border-bottom: 1.4px solid #2d1949;
    }
    .tool-list-table td {
      font-size: 1.01rem;
      color: #f6f3ff;
      font-weight: 600;
    }
    .tool-list-table .btn-tool {
      background: linear-gradient(90deg,#a259f7 0%,#6c67f7 100%);
      color: #fff;
      border: none;
      border-radius: 0.8rem;
      font-weight: 700;
      padding: 0.37rem 1.25rem;
      font-size: 0.96rem;
      margin-left: 0.2rem;
      transition: background .13s;
      cursor: pointer;
    }
    .tool-list-table .btn-tool:hover {
      background: linear-gradient(90deg,#6c67f7 0%,#a259f7 100%);
    }
    .donut-legend {
      display: flex;
      gap: 1.2rem;
      font-size: 0.93rem;
      font-weight: 600;
      margin-top: 1.1rem;
      color: #bba9fa;
    }
    .donut-dot { width: 1.2em; height: 1.2em; border-radius: 50%; display: inline-block; margin-right: 0.5em; }
    .activity-timeline {
      margin-top: 1.2rem;
      border-left: 3px solid #a259f7;
      padding-left: 1.2rem;
      position: relative;
    }
    .activity-dot {
      width: 13px; height: 13px;
      background: #a259f7;
      border-radius: 50%;
      position: absolute;
      left: -8px;
      margin-top: 6px;
      border: 2.5px solid #fff;
      box-shadow: 0 2px 12px #a259f77a;
    }
    .activity-item {
      margin-bottom: 1.1rem;
      position: relative;
      padding-left: 0.3rem;
    }
    .activity-item:last-child { margin-bottom: 0; }
    .activity-time { color: #bba9fa; font-size: 0.97rem; font-weight: 600; margin-left: 0.4rem;}
    @media (max-width: 1300px) {
      .main-content { margin-left: 0; }
      .sidebar { display: none; }
    }
    @media (max-width: 900px) {
      .dashboard-row { flex-direction: column; gap: 1.2rem; }
      .main-content { margin-left: 0; }
      .sidebar { display: none; }
      .dashboard-header-row { flex-direction: column; gap: 1.2rem; align-items: flex-start;}
      .tool-list-card { margin-bottom: 1.2rem;}
    }
  </style>
</head>
<body>
   <nav class="nav-bar">
    <div>
      <div class="nav-logo">
        <img src="/assets/images/bg.png" alt="SafaTech Logo">
        <span>SafaTech</span>
        <span class="tools">Tools</span>
      </div>
      <div class="nav-links">
        <a href="dashboard.html" class="nav-link active" title="Dashboard">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="6"/><path d="M9 9h6v6H9z"/></svg>
        </a>
        <a href="tools/word-counter.html" class="nav-link" title="Word Counter">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><rect x="5" y="5" width="14" height="14" rx="2"/><path d="M8 9h8M8 13h4"/></svg>
        </a>
        <a href="tools/grammar-checker.html" class="nav-link" title="Grammar Checker">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8"/></svg>
        </a>
        <a href="tools/paraphraser.html" class="nav-link" title="Paraphraser">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="6"/><path d="M9 9h6v6H9z"/></svg>
        </a>
        <a href="tools/plagiarism-checker.html" class="nav-link" title="Plagiarism Checker">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><rect x="8" y="8" width="8" height="8" rx="4"/><rect x="3" y="3" width="18" height="18" rx="7"/></svg>
        </a>
        <a href="tools/readability-checker.html" class="nav-link" title="Readability Checker">
          <svg fill="none" stroke="currentColor" stroke-width="2.1" viewBox="0 0 24 24"><rect x="5" y="5" width="14" height="14" rx="2"/><path d="M12 8v8M8 12h8"/></svg>
        </a>
      </div>
    </div>
    <div class="profile-section">
      <!-- Use absolute path for universal access from all locations -->
     <a href="profile.html" class="profile-avatar-link" title="View Profile">
  <div class="profile-avatar" id="profile-avatar">I</div>
</a>
      <div class="profile-name" id="profile-name"></div>
      <div class="profile-meta" id="profile-email"></div>
      <button class="logout-btn" id="logout-btn">Logout</button>
    </div>
  </nav>
  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="dashboard-header-row">
      <div>
        <div class="dashboard-title">Analytics Dashboard</div>
        <div class="dashboard-greeting">Welcome, <span id="dashboard-username">Ibrahim!</span></div>
      </div>
      <div class="user-profile-bar">
        <div class="profile-avatar" id="profile-initial">I</div>
        <div>
          <div class="name" id="profile-bar-name">ibrahim usman</div>
          <div class="email" id="profile-bar-email">ibrahimusman4666@gmail.com</div>
        </div>
      </div>
    </div>
    <!-- LIVE DATA CARDS -->
    <div class="dashboard-row">
      <div class="dashboard-card">
        <div class="dashboard-card-title">Total Words Counted</div>
        <div class="dashboard-card-value" id="dashboard-total-words">0</div>
        <div class="dashboard-card-small">Across all your documents</div>
      </div>
      <div class="dashboard-card">
        <div class="dashboard-card-title">Plagiarism Checks</div>
        <div class="dashboard-card-value" id="dashboard-plagiarism-checks">0</div>
        <div class="dashboard-card-small">This month</div>
      </div>
      <div class="dashboard-card">
        <div class="dashboard-card-title">Grammar Checks</div>
        <div class="dashboard-card-value" id="dashboard-grammar-checks">0</div>
        <div class="dashboard-card-small">This month</div>
      </div>
    </div>
    <!-- Tool Usage Table -->
    <div class="tool-list-card">
      <div class="tool-list-title">Tool Usage Overview</div>
      <table class="tool-list-table">
        <thead>
          <tr>
            <th>Tool</th>
            <th>Last Used</th>
            <th>Uses</th>
            <th>Open</th>
          </tr>
        </thead>
        <tbody id="tool-usage-table">
          <!-- JS will populate -->
        </tbody>
      </table>
    </div>
    <!-- Charts -->
    <div class="dashboard-row">
      <div class="dashboard-card" style="flex:2;">
        <div class="dashboard-card-title">Word Counter Usage (Last 7 Days)</div>
        <canvas id="chart-words" height="110"></canvas>
      </div>
      <div class="dashboard-card" style="flex:1;">
        <div class="dashboard-card-title">Plagiarism Sentiments</div>
        <canvas id="donut-sentiments" height="120"></canvas>
        <div class="donut-legend">
          <span><span class="donut-dot" style="background:#a259f7"></span>Unique</span>
          <span><span class="donut-dot" style="background:#ff4d58"></span>Flagged</span>
          <span><span class="donut-dot" style="background:#b6b6b6"></span>Unchecked</span>
        </div>
      </div>
    </div>
    <!-- Recent Activity Timeline -->
    <div class="tool-list-card">
      <div class="tool-list-title">Recent Activity</div>
      <div class="activity-timeline" id="recent-activity">
        <!-- JS will populate -->
      </div>
    </div>
  </div>
  <script>
    // --- BEGIN TOKEN HANDLING FOR GOOGLE OAUTH ---
    (function(){
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      if(token){
        localStorage.setItem('token', token);
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    })();

    // PROFILE LOGOUT
    document.getElementById('logout-btn').onclick = function() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = "index.html";
    };

    // Simulated User/Stats Data (Replace with real fetch calls to your backend)
    const user = JSON.parse(localStorage.getItem('user')) || {
      name: "ibrahim usman",
      email: "ibrahimusman4666@gmail.com",
    };
    const stats = {
      totalWords: 12583,
      plagiarism: 23,
      grammar: 41,
      toolUsage: [
        { tool: "Word Counter", lastUsed: "Today", uses: 18, link: "tools/word-counter.html" },
        { tool: "Grammar Checker", lastUsed: "2 days ago", uses: 11, link: "tools/grammar-checker.html" },
        { tool: "Paraphraser", lastUsed: "3 days ago", uses: 7, link: "tools/paraphraser.html" },
        { tool: "Plagiarism Checker", lastUsed: "Yesterday", uses: 9, link: "tools/plagiarism-checker.html" },
        { tool: "Readability Checker", lastUsed: "5 days ago", uses: 4, link: "tools/readability-checker.html" },
      ],
      activity: [
        { tool: "Word Counter", color: "#a259f7", desc: "Counted 1,201 words", time: "2 mins ago" },
        { tool: "Plagiarism Checker", color: "#50b2fc", desc: 'Checked "project-report.docx"', time: "1 hour ago" },
        { tool: "Grammar Checker", color: "#ff4d58", desc: "Checked 3 paragraphs", time: "3 hours ago" },
        { tool: "Paraphraser", color: "#0ea5e9", desc: "Paraphrased a sentence", time: "5 hours ago" },
      ],
      wordTrends: [2100, 1800, 3100, 1400, 3800, 2100, 1283],
      donut: [68, 21, 11]
    };

    // Populate user/profile info
    function setProfileInfo() {
      document.getElementById('profile-avatar').textContent = (user.name?user.name[0]:"I").toUpperCase();
      document.getElementById('profile-initial').textContent = (user.name?user.name[0]:"I").toUpperCase();
      document.getElementById('profile-bar-name').textContent = user.name;
      document.getElementById('profile-bar-email').textContent = user.email;
      document.getElementById('dashboard-username').textContent = user.name.split(" ")[0] + "!";
    }
    setProfileInfo();

    // Populate live stats cards
    function setStats() {
      document.getElementById('dashboard-total-words').textContent = stats.totalWords.toLocaleString();
      document.getElementById('dashboard-plagiarism-checks').textContent = stats.plagiarism;
      document.getElementById('dashboard-grammar-checks').textContent = stats.grammar;
    }
    setStats();

    // Tool Usage Table
    function setToolUsage() {
      let html = "";
      stats.toolUsage.forEach(t => {
        html += `
        <tr>
          <td>${t.tool}</td>
          <td>${t.lastUsed}</td>
          <td>${t.uses}</td>
          <td><a href="${t.link}" class="btn-tool">Open</a></td>
        </tr>`;
      });
      document.getElementById('tool-usage-table').innerHTML = html;
    }
    setToolUsage();

    // Activity Timeline
    function setActivity() {
      let html = "";
      stats.activity.forEach(item => {
        html += `<div class="activity-item"><div class="activity-dot" style="background:${item.color}"></div>
          <span class="font-bold" style="color:${item.color}">${item.tool}</span> - ${item.desc} <span class="activity-time">${item.time}</span></div>`;
      });
      document.getElementById('recent-activity').innerHTML = html;
    }
    setActivity();

    // Chart.js Bar (Word Counter Usage)
    const ctx = document.getElementById('chart-words').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: "Words Counted",
          data: stats.wordTrends,
          backgroundColor: [
            'rgba(162,89,247,0.79)',
            'rgba(124,50,230,0.82)',
            'rgba(162,89,247,0.69)',
            'rgba(162,89,247,0.46)',
            'rgba(162,89,247,0.90)',
            'rgba(162,89,247,0.5)',
            'rgba(162,89,247,0.76)'
          ],
          borderRadius: 8
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: {
            grid: { display: false, color: '#a259f730' },
            ticks: { color: '#bba9fa', font: { weight: 700, size: 15 } }
          },
          y: {
            grid: { color: '#a259f719' },
            ticks: { color: '#bba9fa', font: { weight: 700, size: 15 } }
          }
        }
      }
    });

    // Chart.js Donut (Sentiments)
    const ctx2 = document.getElementById('donut-sentiments').getContext('2d');
    new Chart(ctx2, {
      type: 'doughnut',
      data: {
        labels: ['Unique', 'Flagged', 'Unchecked'],
        datasets: [{
          data: stats.donut,
          backgroundColor: [
            '#a259f7',
            '#ff4d58',
            '#b6b6b6'
          ],
          borderWidth: 0,
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        cutout: '72%',
      }
    });

    // Simulate live updates (replace with backend websocket/event fetch for real)
    setTimeout(() => {
      stats.totalWords += 44;
      stats.toolUsage[0].uses += 1;
      stats.activity.unshift({
        tool: "Word Counter",
        color: "#a259f7",
        desc: "Counted 44 words",
        time: "just now"
      });
      setStats();
      setToolUsage();
      setActivity();
    }, 6500);

    // --- BEGIN: Google/Login Token Check and Redirect ---
    if(!localStorage.getItem('token')){
      window.location.href = "login.html";
    }
    // --- END: Google/Login Token Check ---
  </script>
</body>
</html>